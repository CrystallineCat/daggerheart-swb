<form class="flexcol {{cssClass}}" autocomplete="off">
    
    <div class="item-bg" style="background-image: url('{{data.img}}');"></div>
    {{!-- Sheet Header --}}
    <header class="sheet-header">
        <img class="profile-img" src="{{data.img}}" data-edit="img" title="{{data.name}}" height="100" width="100" />
        <div class="header-fields">
            <div class="header-container">
                <div class="header-plate">
                    <div class="header-domain">
                        <input type="text" name="system.chosenDomains.domain-one" value="{{systemData.chosenDomains.domain-one}}" placeholder="Ancestry"/>
                        <input type="text" name="system.chosenDomains.domain-two" value="{{systemData.chosenDomains.domain-two}}" placeholder="Class"/>
                    </div>
                    <h1 class="charname">
                        <input name="name" type="text" value="{{data.name}}" placeholder="Name" />
                    </h1>
                </div>
                <div class="charlevel">
                    <input type="number" name="system.level.value" value="{{systemData.level.value}}"/>
                    <a>Level</a>
                </div>
                <div class="charlevel">
                    <input type="number" name="system.proficiency.value" value="{{systemData.proficiency.value}}"/>
                    <a>Prof.</a>
                </div>
            </div>
            <div class="resources">
                <div class="resource">
                    <label>Wound</label>
                    <div class=resource-container>
                        <div class="resource-group">
                            <input type="number" name="system.health.value" value="{{systemData.health.value}}"/>
                            <a>Current</a>
                        </div>
                        <div class="resource-group">
                            <input type="number" name="system.health.max" value="{{systemData.health.max}}"/>
                            <a>Max</a>
                        </div>
                    </div>
                </div>
                
                <div class="resource">
                    <label>Stress</label>
                    <div class=resource-container>
                        <div class="resource-group">
                            <input type="number" name="system.stress.value" value="{{systemData.stress.value}}"/>
                            <a>Current</a>
                        </div>
                        <div class="resource-group">
                            <input type="number" name="system.stress.max" value="{{systemData.stress.max}}"/>
                            <a>Max</a>
                        </div>      
                    </div> 
                </div>
                
                <div class="resource">
                    <label>Hope</label>
                    <div class=resource-container>
                        <div class="resource-group">
                            <input type="number" name="system.hope.value" value="{{systemData.hope.value}}"/>
                            <a>Current</a>
                        </div>
                        <div class="resource-group">
                            <input type="number" name="system.hope.max" value="{{systemData.hope.max}}"/>
                            <a>Max</a>
                        </div>
                    </div>
                </div>
            </div>
            
        </div>
    </header>
    
    <section class="defenses">
        <div class="armorslots">
            <label>threshold</label>
            <div class="values">
                <div class=resource-container>
                    <!-- <div class="resource-group">
                        <input type="number" name="system.threshold.minor" value="{{systemData.threshold.minor}}"/>
                        <a>Minor</a>
                    </div> -->
                    <div class="resource-group">
                        <input type="number" name="system.threshold.major" value="{{systemData.threshold.major}}"/>
                        <a>Major</a>
                    </div>
                    <div class="resource-group">
                        <input type="number" name="system.threshold.severe" value="{{systemData.threshold.severe}}"/>
                        <a>Severe</a>
                    </div>
                </div>
            </div>
        </div>
        <div class="defense" data-trait="evasion">
            <label for="system.defenses.evasion.value">Evasion</label>
            <input type="number" name="system.defenses.evasion.value" value="{{systemData.defenses.evasion.value}}"/>
        </div>
        <div class="defense" data-trait="armor">
            <label for="system.defenses.armor.value">Armor</label>
            <input type="number" name="system.defenses.armor.value" value="{{systemData.defenses.armor.value}}"/>
        </div>
        <div class="armorslots">
            <label>Armor Slots</label>
            <div class="values">
                <div class=resource-container>
                    <div class="resource-group">
                        <input type="number" name="system.defenses.armor-slots.value" value="{{systemData.defenses.armor-slots.value}}"/>
                        <a>Used</a>
                    </div>
                    <div class="resource-group">
                        <input type="number" name="system.defenses.armor-slots.max" value="{{systemData.defenses.armor-slots.max}}"/>
                        <a>Max</a>
                    </div>
                </div>
            </div>
        </div>
    </section>
    
    <section class="traits">
        <div class="trait" data-trait="agility">
            <div class="trait-label-wrapper">
                <label for="system.agility.value">Agility</label>
                <div class="trait-tooltip">
                    <div class="tooltip" name="system.agility.tooltip" value="{{systemData.agility.tooltip}}">
                        {{editor agilityHTML target="system.agility.tooltip" button=false editable=false engine="prosemirror" markdown=true}}
                    </div>
                </div>
            </div>
            <input type="number" name="system.agility.value" value="{{systemData.agility.value}}"/>
            <div class="trait-effects">
                <a>Sprint</a>
                <a>Dodge</a>
                <a>Leap</a>
            </div>
        </div>
        <div class="trait" data-trait="strength">
            <div class="trait-label-wrapper">
                <label for="system.strength.value">Strength</label>
                <div class="trait-tooltip">
                    <div class="tooltip" name="system.strength.tooltip" value="{{systemData.strength.tooltip}}">
                        {{editor strengthHTML target="system.strength.tooltip" button=false editable=false engine="prosemirror" markdown=true}}
                    </div>
                </div>
            </div>
            <input type="number" name="system.strength.value" value="{{systemData.strength.value}}"/>
            <div class="trait-effects">
                <a>Lift</a>
                <a>Smash</a>
                <a>Grapple</a>
            </div>
        </div>
        <div class="trait" data-trait="finesse">
            <div class="trait-label-wrapper">
                <label for="system.finesse.value">Finesse</label>
                <div class="trait-tooltip">
                    <div class="tooltip" name="system.finesse.tooltip" value="{{systemData.finesse.tooltip}}">
                        {{editor finesseHTML target="system.agility.tooltip" button=false editable=false engine="prosemirror" markdown=true}}
                    </div>
                </div>
            </div>
            <input type="number" name="system.finesse.value" value="{{systemData.finesse.value}}"/>
            <div class="trait-effects">
                <a>Control</a>
                <a>Hide</a>
                <a>Tinker</a>
            </div>
        </div>
        <div class="trait" data-trait="instinct">
            <div class="trait-label-wrapper">
                <label for="system.instinct.value">Instinct</label>
                <div class="trait-tooltip">
                    <div class="tooltip" name="system.instinct.tooltip" value="{{systemData.instinct.tooltip}}">
                        {{editor instinctHTML target="system.agility.tooltip" button=false editable=false engine="prosemirror" markdown=true}}
                    </div>
                </div>
            </div>
            <input type="number" name="system.instinct.value" value="{{systemData.instinct.value}}"/>
            <div class="trait-effects">
                <a>Perceive</a>
                <a>Sense</a>
                <a>Navigate</a>
            </div>
        </div>
        <div class="trait" data-trait="presence">
            <div class="trait-label-wrapper">
                <label for="system.presence.value">Presence</label>
                <div class="trait-tooltip">
                    <div class="tooltip" name="system.presence.tooltip" value="{{systemData.presence.tooltip}}">
                        {{editor presenceHTML target="system.agility.tooltip" button=false editable=false engine="prosemirror" markdown=true}}
                    </div>
                </div>
            </div>
            <input type="number" name="system.presence.value" value="{{systemData.presence.value}}"/>
            <div class="trait-effects">
                <a>Charm</a>
                <a>Perform</a>
                <a>Deceive</a>
            </div>
        </div>
        <div class="trait" data-trait="knowledge">
            <div class="trait-label-wrapper">
                <label for="system.knowledge.value">Knowledge</label>
                <div class="trait-tooltip">
                    <div class="tooltip" name="system.knowledge.tooltip" value="{{systemData.knowledge.tooltip}}">
                        {{editor knowledgeHTML target="system.agility.tooltip" button=false editable=false engine="prosemirror" markdown=true}}
                    </div>
                </div>
            </div>
            <input type="number" name="system.knowledge.value" value="{{systemData.knowledge.value}}"/>
            <div class="trait-effects">
                <a>Recall</a>
                <a>Analyze</a>
                <a>Comprehend</a>
            </div>
        </div>
    </section>
    
    {{!-- Sheet Tab Navigation --}}
    <nav class="sheet-tabs tabs" data-group="primary">
        <a class="item" data-tab="experience" data-tooltip="Experience"><i class="fas fa-solid fa-feather"></i></a>
        <a class="item" data-tab="weapons" data-tooltip="Weapons"><i class="fas fa-solid fa-fan"></i></a>
        <a class="item" data-tab="features" data-tooltip="Features"><i class="fas fa-solid fa-bolt-lightning"></i></a>
        <a class="item" data-tab="inventory" data-tooltip="Inventory"><i class="fas fa-solid fa-briefcase"></i></a>
        <a class="item" data-tab="description" data-tooltip="Description"><i class="fas fa-solid fa-fingerprint"></i></a>
        <a class="item" data-tab="playernotes" data-tooltip="Notes"><i class="fas fa-solid fa-book"></i></a>

        
    </nav>
    
    {{!-- Sheet Body --}}
    <section class="sheet-body">
        
        {{!-- Biography Tab --}}
        <div class="tab description" data-group="primary" data-tab="description">
            <div class="tab-title">Description</div>
            {{editor biographyHTML target="system.biography" button=true editable=editable engine="prosemirror"}}
        </div>
        
        {{!-- Inventory Tab --}}
        <div class="tab playernotes" data-group="primary" data-tab="playernotes">
            <div class="tab-title">Notes</div>
            {{editor inventoryHTML target="system.inventory" button=true editable=editable engine="prosemirror"}}
        </div>
        
        <!--{{!-- Domains Tab --}}
            <section class="domains-section">
                <div class="domain-cards">
                    {{#each domains as |domain|}}
                    <div class="card" data-card-id="{{domain._id}}">
                        <img src="{{domain.img}}" title="{{domain.name}}" />
                        <button class="remove-card" data-card-id="{{domain._id}}"><i class="fas fa-times"></i></button>
                    </div>
                    {{/each}}
                </div>
            </section> -->
            
            
            {{!-- Weapon Tab --}}
            <div class="tab weapons" data-group="primary" data-tab="weapons">
                <div class="tab-title">Weapons</div>
                <div class="weapon-group">
                    <div class="weapon-row">
                        <label class="weapon-label">Primary</label>
                        <div class="weapon-box click-rollable-group basic-rollable-group">
                            <div class="weapon-box-inner">
                                <div class="weapon-infobox-first">
                                    <input class="weapon-field basic-rollable-name click-rollable-name" name="system.weapon-main.name" type="text" value="{{systemData.weapon-main.name}}" placeholder="Weapon (Modifier)"/>
                                    <a class="weapon-a-label">Weapon</a>
                                </div>
                                <div class="weapon-roller-box">
                                    <div class="weapon-infobox">
                                        <input class="weapon-to-hit click-rollable-modifier" name="system.weapon-main.to-hit" type="number" value="{{systemData.weapon-main.to-hit}}" placeholder="2"/>
                                        <a class="click-rollable">Modifier</a>
                                    </div>
                                    <div class="weapon-infobox">
                                        <input class="weapon-damage basic-rollable-value" name="system.weapon-main.damage" type="text" value="{{systemData.weapon-main.damage}}" placeholder="1d8"/>
                                        <a class="basic-rollable">Damage</a>
                                    </div>
                                </div>
                            </div>
                            <div class="textarea-container">
                                <input class="weapon-desc resize-ta" name="system.weapon-main.description" placeholder="Input your weapon abilities, description, passive and other relevant notes here." value="{{systemData.weapon-main.description}}"/>
                            </div>
                        </div>
                    </div>

                    <div class="weapon-row">
                        <label class="weapon-label">Secondary</label>
                        <div class="weapon-box click-rollable-group basic-rollable-group">
                            <div class="weapon-box-inner">
                                <div class="weapon-infobox-first">
                                    <input class="weapon-field basic-rollable-name click-rollable-name" name="system.weapon-off.name" type="text" value="{{systemData.weapon-off.name}}" placeholder="Weapon (Modifier)"/>
                                    <a class="weapon-a-label">Weapon</a>
                                </div>
                                <div class="weapon-roller-box">
                                    <div class="weapon-infobox">
                                        <input class="weapon-to-hit click-rollable-modifier" name="system.weapon-off.to-hit" type="number" value="{{systemData.weapon-off.to-hit}}" placeholder="2"/>
                                        <a class="click-rollable">Modifier</a>
                                    </div>
                                    <div class="weapon-infobox">
                                        <input class="weapon-damage basic-rollable-value" name="system.weapon-off.damage" type="text" value="{{systemData.weapon-off.damage}}" placeholder="1d8"/>
                                        <a class="basic-rollable">Damage</a>
                                    </div>
                                </div>
                            </div>
                            <div class="textarea-container">
                                <input class="weapon-desc resize-ta" name="system.weapon-off.description" placeholder="Input your weapon abilities, description, passive and other relevant notes here." value="{{systemData.weapon-off.description}}"/>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            {{!-- Experience Tab --}}
            <div class="tab experience" data-group="primary" data-tab="experience">
                <div class="tab-title">Experience</div>
                <div class="experience-group">
                    <div class="experience-row click-rollable-group">
                        <div class="experience-row-column">
                            <div class="exp-level"><input type="number" name="system.experience.1level" value="{{systemData.experience.1level}}"/></div>
                            <a>Level</a>
                        </div>
                        <div class="experience-row-column">
                            <input class="click-rollable-name" name="system.experience.1Name" type="text" value="{{systemData.experience.1Name}}" placeholder=""/>
                            <a class="click-rollable-name">Experience</a>
                        </div>
                        <div class="experience-row-column">
                            <input class="click-rollable-modifier"type="number" name="system.experience.1Mod" value="{{systemData.experience.1Mod}}"/>
                            <a class="click-rollable">Modifier</a>
                        </div>
                    </div>
                    <div class="experience-row click-rollable-group">
                        <div class="experience-row-column">
                            <div class="exp-level"><input type="number" name="system.experience.11level" value="{{systemData.experience.11level}}"/></div>
                            <a>Level</a>
                        </div>
                        <div class="experience-row-column">
                            <input class="click-rollable-name" name="system.experience.1Name2" type="text" value="{{systemData.experience.1Name2}}" placeholder=""/>
                            <a class="click-rollable-name">Experience</a>
                        </div>
                        <div class="experience-row-column">
                            <input class="click-rollable-modifier"type="number" name="system.experience.1Mod2" value="{{systemData.experience.1Mod2}}"/>
                            <a class="click-rollable">Modifier</a>
                        </div>
                    </div>
                    <div class="experience-row click-rollable-group">
                        <div class="experience-row-column">
                            <div class="exp-level"><input type="number" name="system.experience.2level" value="{{systemData.experience.2level}}"/></div>
                            <a>Level</a>
                        </div>
                        <div class="experience-row-column">
                            <input class="click-rollable-name" name="system.experience.2Name" type="text" value="{{systemData.experience.2Name}}" placeholder=""/>
                            <a class="click-rollable-name">Experience</a>
                        </div>
                        <div class="experience-row-column">
                            <input class="click-rollable-modifier"type="number" name="system.experience.2Mod" value="{{systemData.experience.2Mod}}"/>
                            <a class="click-rollable">Modifier</a>
                        </div>
                    </div>
                    <div class="experience-row click-rollable-group">
                        <div class="experience-row-column">
                            <div class="exp-level"><input type="number" name="system.experience.5level" value="{{systemData.experience.5level}}"/></div>
                            <a>Level</a>
                        </div>
                        <div class="experience-row-column">
                            <input class="click-rollable-name" name="system.experience.5Name" type="text" value="{{systemData.experience.5Name}}" placeholder=""/>
                            <a class="click-rollable-name">Experience</a>
                        </div>
                        <div class="experience-row-column">
                            <input class="click-rollable-modifier"type="number" name="system.experience.5Mod" value="{{systemData.experience.5Mod}}"/>
                            <a class="click-rollable">Modifier</a>
                        </div>
                    </div>
                    <div class="experience-row click-rollable-group">
                        <div class="experience-row-column">
                            <div class="exp-level"><input type="number" name="system.experience.8level" value="{{systemData.experience.8level}}"/></div>
                            <a>Level</a>
                        </div>
                        <div class="experience-row-column">
                            <input class="click-rollable-name" name="system.experience.8Name" type="text" value="{{systemData.experience.8Name}}" placeholder=""/>
                            <a class="click-rollable-name">Experience</a>
                        </div>
                        <div class="experience-row-column">
                            <input class="click-rollable-modifier"type="number" name="system.experience.8Mod" value="{{systemData.experience.8Mod}}"/>
                            <a class="click-rollable">Modifier</a>
                        </div>
                    </div>
                </div>
            </div>
            
            {{!-- Owned Items Tab --}}
            <div class="tab features" data-group="primary" data-tab="features">
                <div class="tab-title">Features & Domains</div>

                <div class="tab-category">Domains
                    <a class="item-control" title="{{ localize 'SIMPLE.ItemCreate' }}" data-action="create-domain" data-type="domain">
                        <i class="fas fa-plus"></i> Add Domain
                    </a>
                </div>
                <ol class="item-list" data-type="domain">
                    {{#each data.items as |item id|}}
                    {{#if (eq item.type "domain")}}
                    <li class="item flexrow" data-item-id="{{item._id}}">
                        <div class="item-main-row">
                            <div class="item-top-row">
                                <img class="item-control" data-action="edit" src="{{item.img}}" title="{{item.name}}" width="30" height="30" />
                                <h4 class="item-name item-control" data-action="edit">{{item.name}}</h4>
                                <div class="item-buttons">
                                    {{#each item.system.attributes as |itemAttr key|}}
                                    {{#if itemAttr.dtype}}
                                        {{#if itemAttr.isFormula}}
                                            {{!-- Use the items.name.key format for shorthand. --}}
                                            {{#if ../../shorthand}}
                                            <button class="item-button rollable" data-roll="@items.{{slugify item.name}}.{{key}}" data-label="{{ itemAttr.label }}"
                                                title="{{itemAttr.value}}">{{itemAttr.label}}</button>
                                            {{!-- Use the items.name.attributes.key.value format otherwise. --}}
                                            {{else}}
                                            <button class="item-button rollable"
                                                data-roll="@items.{{slugify item.name}}.attributes.{{key}}.value" data-label="{{ itemAttr.label }}"
                                                title="{{itemAttr.value}}">{{itemAttr.label}}</button>
                                            {{/if}}
                                        {{/if}}
                                    {{else}}
                                        {{#each itemAttr as |itemGroupedAttr groupedKey|}}
                                            {{#if itemGroupedAttr.isFormula}}
                                                {{!-- Use the items.name.key format for shorthand. --}}
                                                {{#if ../../../shorthand}}
                                                <button class="item-button rollable" data-roll="@items.{{slugify item.name}}.{{key}}.{{groupedKey}}" data-label="{{ itemGroupedAttr.label }}"
                                                    title="{{itemGroupedAttr.value}}">{{itemGroupedAttr.label}}</button>
                                                {{!-- Use the items.name.attributes.key.value format otherwise. --}}
                                                {{else}}
                                                <button class="item-button rollable"
                                                    data-roll="@items.{{slugify item.name}}.attributes.{{key}}.{{groupedKey}}.value" data-label="{{ itemGroupedAttr.label }}"
                                                    title="{{itemGroupedAttr.value}}">{{itemGroupedAttr.label}}</button>
                                                {{/if}}
                                            {{/if}}
                                        {{/each}}
                                    {{/if}}
                                    {{/each}}
                                </div>
                            </div>
                        </div>
                        <div class="item-controls">
                            <a class="item-control" title="{{ localize "SIMPLE.ItemEdit" }}" data-action="edit"><i class="fas fa-edit"></i></a>
                            <a class="item-control" title="{{ localize "SIMPLE.ItemDelete" }}" data-action="delete"><i class="fas fa-trash"></i></a>
                        </div>
                    </li>
                    {{/if}}
                    {{/each}}
                </ol>

                <div class="tab-category">Features
                    <a class="item-control" title="{{ localize 'SIMPLE.ItemCreate' }}" data-action="create" data-type="item">
                        <i class="fas fa-plus"></i> Add Feature
                    </a>
                </div>
                <ol class="item-list" data-type="item">
                    {{#each data.items as |item id|}}
                    {{#if (eq item.type "item")}}
                    <li class="item flexrow" data-item-id="{{item._id}}">
                        <div class="item-main-row">
                            <div class="item-top-row">
                                <img class="item-control" data-action="edit" src="{{item.img}}" title="{{item.name}}" width="30" height="30" />
                                <h4 class="item-name item-control" data-action="edit">{{item.name}}</h4>
                                <div class="item-buttons">
                                    {{#each item.system.attributes as |itemAttr key|}}
                                    {{#if itemAttr.dtype}}
                                        {{#if itemAttr.isFormula}}
                                            {{!-- Use the items.name.key format for shorthand. --}}
                                            {{#if ../../shorthand}}
                                            <button class="item-button rollable" data-roll="@items.{{slugify item.name}}.{{key}}" data-label="{{ itemAttr.label }}"
                                                title="{{itemAttr.value}}">{{itemAttr.label}}</button>
                                            {{!-- Use the items.name.attributes.key.value format otherwise. --}}
                                            {{else}}
                                            <button class="item-button rollable"
                                                data-roll="@items.{{slugify item.name}}.attributes.{{key}}.value" data-label="{{ itemAttr.label }}"
                                                title="{{itemAttr.value}}">{{itemAttr.label}}</button>
                                            {{/if}}
                                        {{/if}}
                                    {{else}}
                                        {{#each itemAttr as |itemGroupedAttr groupedKey|}}
                                            {{#if itemGroupedAttr.isFormula}}
                                                {{!-- Use the items.name.key format for shorthand. --}}
                                                {{#if ../../../shorthand}}
                                                <button class="item-button rollable" data-roll="@items.{{slugify item.name}}.{{key}}.{{groupedKey}}" data-label="{{ itemGroupedAttr.label }}"
                                                    title="{{itemGroupedAttr.value}}">{{itemGroupedAttr.label}}</button>
                                                {{!-- Use the items.name.attributes.key.value format otherwise. --}}
                                                {{else}}
                                                <button class="item-button rollable"
                                                    data-roll="@items.{{slugify item.name}}.attributes.{{key}}.{{groupedKey}}.value" data-label="{{ itemGroupedAttr.label }}"
                                                    title="{{itemGroupedAttr.value}}">{{itemGroupedAttr.label}}</button>
                                                {{/if}}
                                            {{/if}}
                                        {{/each}}
                                    {{/if}}
                                    {{/each}}
                                </div>
                            </div>
                        </div>
                        <div class="item-controls">
                            <a class="item-control" title="{{ localize "SIMPLE.ItemEdit" }}" data-action="edit"><i class="fas fa-edit"></i></a>
                            <a class="item-control" title="{{ localize "SIMPLE.ItemDelete" }}" data-action="delete"><i class="fas fa-trash"></i></a>
                        </div>
                    </li>
                    {{/if}}
                    {{/each}}
                </ol>
            </div>
            
            {{!-- Owned Inventory Tab --}}
            <div class="tab inventory" data-group="primary" data-tab="inventory">
                <div class="tab-title">Inventory</div>
                <div class="tab-category">Worn
                    <a class="item-control" title="{{ localize 'SIMPLE.ItemCreate' }}" data-action="create-item" data-type="worn">
                        <i class="fas fa-plus"></i> Add Item
                    </a>
                </div>
                <ol class="item-list" data-type="worn">
                    {{#each data.items as |item id|}}
                    {{#if (eq item.type "worn")}}
                    <li class="item flexrow" data-item-id="{{item._id}}">
                        <div class="item-main-row">
                            <div class="item-top-row">
                                <img class="item-control" data-action="edit" src="{{item.img}}" title="{{item.name}}" width="30" height="30" />
                                <h4 class="item-name item-control" data-action="edit">{{item.name}}</h4>
                                <div class="item-buttons">
                                    {{#each item.system.attributes as |itemAttr key|}}
                                    {{#if itemAttr.dtype}}
                                        {{#if itemAttr.isFormula}}
                                            {{!-- Use the items.name.key format for shorthand. --}}
                                            {{#if ../../shorthand}}
                                            <button class="item-button rollable" data-roll="@items.{{slugify item.name}}.{{key}}" data-label="{{ itemAttr.label }}"
                                                title="{{itemAttr.value}}">{{itemAttr.label}}</button>
                                            {{!-- Use the items.name.attributes.key.value format otherwise. --}}
                                            {{else}}
                                            <button class="item-button rollable"
                                                data-roll="@items.{{slugify item.name}}.attributes.{{key}}.value" data-label="{{ itemAttr.label }}"
                                                title="{{itemAttr.value}}">{{itemAttr.label}}</button>
                                            {{/if}}
                                        {{/if}}
                                    {{else}}
                                        {{#each itemAttr as |itemGroupedAttr groupedKey|}}
                                            {{#if itemGroupedAttr.isFormula}}
                                                {{!-- Use the items.name.key format for shorthand. --}}
                                                {{#if ../../../shorthand}}
                                                <button class="item-button rollable" data-roll="@items.{{slugify item.name}}.{{key}}.{{groupedKey}}" data-label="{{ itemGroupedAttr.label }}"
                                                    title="{{itemGroupedAttr.value}}">{{itemGroupedAttr.label}}</button>
                                                {{!-- Use the items.name.attributes.key.value format otherwise. --}}
                                                {{else}}
                                                <button class="item-button rollable"
                                                    data-roll="@items.{{slugify item.name}}.attributes.{{key}}.{{groupedKey}}.value" data-label="{{ itemGroupedAttr.label }}"
                                                    title="{{itemGroupedAttr.value}}">{{itemGroupedAttr.label}}</button>
                                                {{/if}}
                                            {{/if}}
                                        {{/each}}
                                    {{/if}}
                                    {{/each}}
                                </div>
                            </div>
                        </div>
                        <div class="item-controls">
                            <a class="item-control" title="{{ localize "SIMPLE.ItemEdit" }}" data-action="edit"><i class="fas fa-edit"></i></a>
                            <a class="item-control" title="{{ localize "SIMPLE.ItemDelete" }}" data-action="delete"><i class="fas fa-trash"></i></a>
                        </div>
                    </li>
                    {{/if}}
                    {{/each}}
                </ol>

                <div class="tab-category">Backpack
                    <a class="item-control" title="{{ localize 'SIMPLE.ItemCreate' }}" data-action="create-item" data-type="inventory">
                        <i class="fas fa-plus"></i> Add Item
                    </a>
                </div>
                <ol class="item-list" data-type="inventory">
                    {{#each data.items as |item id|}}
                    {{#if (eq item.type "inventory")}}
                    <li class="item flexrow" data-item-id="{{item._id}}">
                        <div class="item-main-row">
                            <div class="item-top-row">
                                <img class="item-control" data-action="edit" src="{{item.img}}" title="{{item.name}}" width="30" height="30" />
                                <h4 class="item-name item-control" data-action="edit">{{item.name}}</h4>
                                <div class="item-buttons">
                                    {{#each item.system.attributes as |itemAttr key|}}
                                    {{#if itemAttr.dtype}}
                                        {{#if itemAttr.isFormula}}
                                            {{!-- Use the items.name.key format for shorthand. --}}
                                            {{#if ../../shorthand}}
                                            <button class="item-button rollable" data-roll="@items.{{slugify item.name}}.{{key}}" data-label="{{ itemAttr.label }}"
                                                title="{{itemAttr.value}}">{{itemAttr.label}}</button>
                                            {{!-- Use the items.name.attributes.key.value format otherwise. --}}
                                            {{else}}
                                            <button class="item-button rollable"
                                                data-roll="@items.{{slugify item.name}}.attributes.{{key}}.value" data-label="{{ itemAttr.label }}"
                                                title="{{itemAttr.value}}">{{itemAttr.label}}</button>
                                            {{/if}}
                                        {{/if}}
                                    {{else}}
                                        {{#each itemAttr as |itemGroupedAttr groupedKey|}}
                                            {{#if itemGroupedAttr.isFormula}}
                                                {{!-- Use the items.name.key format for shorthand. --}}
                                                {{#if ../../../shorthand}}
                                                <button class="item-button rollable" data-roll="@items.{{slugify item.name}}.{{key}}.{{groupedKey}}" data-label="{{ itemGroupedAttr.label }}"
                                                    title="{{itemGroupedAttr.value}}">{{itemGroupedAttr.label}}</button>
                                                {{!-- Use the items.name.attributes.key.value format otherwise. --}}
                                                {{else}}
                                                <button class="item-button rollable"
                                                    data-roll="@items.{{slugify item.name}}.attributes.{{key}}.{{groupedKey}}.value" data-label="{{ itemGroupedAttr.label }}"
                                                    title="{{itemGroupedAttr.value}}">{{itemGroupedAttr.label}}</button>
                                                {{/if}}
                                            {{/if}}
                                        {{/each}}
                                    {{/if}}
                                    {{/each}}
                                </div>
                            </div>
                        </div>
                        <div class="item-controls">
                            <a class="item-control" title="{{ localize "SIMPLE.ItemEdit" }}" data-action="edit"><i class="fas fa-edit"></i></a>
                            <a class="item-control" title="{{ localize "SIMPLE.ItemDelete" }}" data-action="delete"><i class="fas fa-trash"></i></a>
                        </div>
                    </li>
                    {{/if}}
                    {{/each}}
                </ol>
            </div>
            
            {{!-- Attributes Tab --}}
            <div class="tab attributes" data-group="primary" data-tab="attributes">
                <header class="attributes-header flexrow">
                    <span class="attribute-key">{{localize "SIMPLE.AttributeKey"}}</span>
                    <span class="attribute-value">{{localize "SIMPLE.AttributeValue"}}</span>
                    <span class="attribute-label">{{localize "SIMPLE.AttributeLabel"}}</span>
                    <span class="attribute-dtype">{{localize "SIMPLE.AttributeDtype"}}</span>
                    <a class="attribute-control" data-action="create" data-group="{{group}}"><i class="fas fa-plus"></i></a>
                </header>
                
                {{!-- Render the attribute list partial. --}}
                {{> "systems/worldbuilding/templates/parts/sheet-attributes.html" attributes=systemData.ungroupedAttributes dtypes=dtypes}}
                
                {{!-- Render the grouped attributes partial and control. --}}
                <div class="groups">
                    {{> "systems/worldbuilding/templates/parts/sheet-groups.html" attributes=systemData.groupedAttributes groups=systemData.groups dtypes=dtypes}}
                    
                    <div class="group-controls flexrow">
                        <input class="group-prefix" type="text" value=""/>
                        <a class="button group-control" data-action="create-group"><i class="fas fa-plus"></i>Add Attribute Group</a>
                    </div>
                </div>
            </div>
            
        </section>
    </form>
    